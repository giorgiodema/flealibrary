I"k(function() {
  var chat_controller;

  chat_controller = {};

  chat_controller.hide_chat = function() {
    return $("[name='close_chat']").click(function() {
      $(this).parents(".chat_div").css("display", "none");
    });
  };

  chat_controller.show_chat = function() {
    return $(".chat_list_item").click(function() {
      var id;
      $(".chat_div").css("display", "none");
      id = $(this).children("[name='chat_id']").attr("content");
      $("#" + id.toString()).css("display", "block");
    });
  };

  chat_controller.send_message = function() {
    return $(".chat_div").keypress(function(e) {
      var msg;
      if (e.keyCode === 13) {
        msg = {
          chat_id: $(this).attr("id"),
          text: $(this).children(".input_box").val()
        };
        return chat_controller.post_message(msg);
      }
    });
  };

  chat_controller.post_message = function(msg) {
    var token;
    token = $("[name='csrf-token']").attr("content");
    return $.ajax('/send_message', {
      type: 'POST',
      dataType: 'json',
      data: {
        msg: msg
      },
      headers: {
        "X-CSRF-Token": token
      },
      error: function(jqXHR, textStatus, errorThrown) {
        return console.log("error:chat_controller.post_message");
      },
      success: function(data, textStatus, jqXHR) {
        console.log("Status:" + textStatus);
        console.log("Data:" + data["myanswer"]);
        $("#" + msg.chat_id).children(".input_box").val("");
        return $("#" + msg.chat_id).children(".message_box").append("<li class=sent_message><p class=message_text> " + msg.text + " </p></li>");
      }
    });
  };

  chat_controller.delete_chat = function() {
    return $(".chat_list_item input").click(function() {
      var chat_id, token;
      chat_id = $(this).parent().children("meta[name='chat_id']").attr("content");
      token = $("[name='csrf-token']").attr("content");
      return $.ajax('/delete_chat', {
        type: 'POST',
        dataType: 'json',
        data: {
          "chat_id": chat_id
        },
        headers: {
          "X-CSRF-Token": token
        },
        error: function(jqXHR, textStatus, errorThrown) {
          return console.log("error:chat_controller.delete_chat");
        },
        success: function(data, textStatus, jqXHR) {
          console.log("Status:" + textStatus);
          $("#chats_list").children().each(function(index, element) {
            var id;
            id = $(element).children("meta[name='chat_id']").attr("content");
            if (id === chat_id) {
              return element.remove();
            }
          });
          return $("#" + chat_id).remove();
        }
      });
    });
  };

  chat_controller.create_chat = function() {
    return $('#start_chat').click(function() {
      var guest_id, token;
      console.log("chat_controller.create_chat");
      guest_id = $(this).parent().children("[name='user_id']").attr('content');
      console.log("guest_id:" + guest_id);
      token = $("[name='csrf-token']").attr("content");
      return $.ajax('/create_chat', {
        type: 'POST',
        dataType: 'json',
        data: {
          "guest_id": guest_id
        },
        headers: {
          "X-CSRF-Token": token
        },
        error: function(jqXHR, textStatus, errorThrown) {
          console.log("error:chat_controller.create_chat");
          return alert("Error: could not create chat");
        },
        success: function(data, textStatus, jqXHR) {
          if (data["status"] === "created") {
            return alert("Chat successfully created");
          } else {
            return alert("Error: could not create chat");
          }
        }
      });
    });
  };

  $(document).ready(function() {
    chat_controller.show_chat();
    chat_controller.hide_chat();
    chat_controller.send_message();
    chat_controller.delete_chat();
    chat_controller.create_chat();
  });

}).call(this);
:ET